#------------------------------------------------------#Import Data Sets 
getwd()
setwd("C:\\Users\\zara\\Documents\\Data Science Portfolio_Zara Clacken\\Data Frames I Created")
Forwards = read.csv("2021-2022 English Premier League Forward List.csv")
Salary = read.csv("2021-2022 Premier League Forward Annual Salary.csv")
Nationalities = read.csv("2021-2022 Premier League Players Nationalities.csv")

install.packages("tidyverse")
#------------------------------------------------Data Cleaning & Mining Forwards

head(Forwards)
summary(Forwards)

#Convert birth dates to date variables 
Forwards$born = as.Date.character(Forwards$born,format = "%d/%m/%Y")
summary(Forwards)
str(Forwards)
head(Forwards)

#Rename birth dates from born to DOB
colnames(Forwards)[3] = "Birthdate"
head(Forwards)

#Separate height numbers from cm by space between number and cm 
library(tidyverse)
library(magrittr)
Forwards %<>% separate(Height, c("Height(cm)", "dropcm"), sep = ' ') 
head(Forwards)

#drop the cm column
Forwards$dropcm = NULL
head(Forwards)

#drop the Position column
Forwards$Position = NULL
head(Forwards)

#Convert Height column to numeric variables
Forwards$`Height(cm)`= as.numeric(Forwards$`Height(cm)`)
str(Forwards)
head(Forwards)

#Split names into first and last names
Forwards %<>% separate(Player, c("First_Name", "Last_Name"), sep = ' ') 
Forwards$Last_Name = as.factor(Forwards$Last_Name)
Forwards$First_Name = as.factor(Forwards$First_Name)
head(Forwards)
str(Forwards)

#Mononymous players' first names as last names
nrow(Forwards)
for (i in seq(1,150)) {
  if(is.na(Forwards$Last_Name[i])) {
    Forwards$Last_Name[i] = Forwards$First_Name[i]
  }
}
Forwards

#Sort data frames by last name in alphabetical order A-Z
Forwards[order(Forwards$Last_Name,decreasing = FALSE),]
head(Forwards)

#--------------------------------------------------Data Cleaning & Mining Salary

head(Salary)
str(Salary)

#Separate Player into first name and last name
Salary %<>% separate(PLAYER, c("First_Name", "Last_Name"), sep = ' ') 
head(Salary)

#Drop rows with the word Forward in them
nrow(Salary)
for (j in seq(1,228)) {
  if(Salary$First_Name[j] == "FORWARD"){
  Salary = Salary[-j,]
  }
}
head(Salary)

#Drop Team Column
Salary$TEAM = NULL
head(Salary)

#Remove the pound sign and commas from the salaries  
Salary$ANNUAL.SALARY = gsub('[£,","]', ' ', Salary$ANNUAL.SALARY)

#Remove the white spaces
Salary$ANNUAL.SALARY = gsub(' ', '', Salary$ANNUAL.SALARY)
head(Salary)

#Change Salary to Numeric type
Salary$ANNUAL.SALARY = as.numeric(Salary$ANNUAL.SALARY)
str(Salary)

#Rename ANNUAL.SALARY column
colnames(Salary)[3] = "Salary(£)"
head(Salary)

#--------------------------------------------Data Clean Nationalities Data Frame

head(Nationalities)

#Drop players who are not forwards
Nationalities = Nationalities[Nationalities$Position == "Forward",]   
head(Nationalities)
unique(Nationalities$Position)

#Fix Player Name Column 
head(Nationalities)
Nationalities %<>% separate(Player, 
                            c("Photodrop", "fordrop","First_Name","Namedrop","Last_Name"), 
                            sep = ' ') 
head(Nationalities)
Nationalities = Nationalities[,c("First_Name","Last_Name","Position","Nationality")]
head(Nationalities)

#-------------------------------------------------------Create merged data frame 

ForwardProfiles = merge.data.frame(Forwards,Salary, by = "Last_Name")
ForwardProfiles = merge.data.frame(ForwardProfiles,Nationalities, by = "Last_Name")
head(ForwardProfiles)

#Drop unnecessary columns 
ForwardProfiles$First_Name.y = NULL
ForwardProfiles$First_Name = NULL
ForwardProfiles$Position =NULL
colnames(ForwardProfiles)[2]  =  "First_Name"
head(ForwardProfiles)


#Drop Players who will earn zero pounds in the 2021-2022 season 
nrow(ForwardProfiles)
min(ForwardProfiles$`Salary(£)`)
ForwardProfiles = ForwardProfiles[ForwardProfiles$`Salary(£)` != 0,]
min(ForwardProfiles$`Salary(£)`)

#Add Age Column to Merged Data Frame
ForwardProfiles$"Age(2021)" = 2021 - as.numeric(format(ForwardProfiles$Birthdate,format = "%Y"))
head(ForwardProfiles)
